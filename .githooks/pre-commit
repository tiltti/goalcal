#!/bin/bash

# Auto-increment version on each commit
# Version format: 0.2.X where X is the commit count

cd "$(git rev-parse --show-toplevel)"

# Get current commit count (will be +1 after this commit)
COMMIT_COUNT=$(($(git rev-list --count HEAD 2>/dev/null || echo 0) + 1))

# Create version file
VERSION="0.2.${COMMIT_COUNT}"
echo "{\"version\": \"${VERSION}\", \"buildTime\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"}" > src/version.json

# Add version file to commit
git add src/version.json

echo "Version updated to ${VERSION}"
